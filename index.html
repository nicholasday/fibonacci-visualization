<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Fibonacci Visualization</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/katex.min.css" rel="stylesheet" >
    <link href="css/slider.css" rel="stylesheet" >
    <link href="css/styles.css" rel="stylesheet" >
</head>
<body>
<div class="container center">
    <h1 class="center">Fibonacci Sequence</h1>
    <hr />
    <div class="row">
        <div class="col-md-4">
            <h3 class="center">Recursive Equation</h3>
            <div id="equation"></div>
        </div>
        <div class="col-md-4 dynamic">
            <input type="range" min="1" max="15" id="equationInput" class="equationInput">
            <div id="equationResult" class="equationResult"></div>
            <div class="equationResult2"></div>
        </div>
        <div class="col-md-4">
            <h3 class="center">Explicit Equation</h3>
            <div id="explicitEquation"></div>
        </div>
    </div>
    <hr />
    <svg id="svg"></svg>
</div>
<script src="js/d3.min.js"></script>
<script src="js/katex.min.js"></script>
<script src="js/jquery-3.1.1.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
var element = document.getElementById("equation");
var element2 = document.getElementById("explicitEquation");

var recursiveEquation = "\\begin{aligned}" +
    "f(x)=\\begin{cases} " +
    "1 & x = 1, 2\\\\ " +
    "f(x -2) + f(x - 1) & x > 1 " +
    "\\end{cases}" +
    "\\end{aligned}";

var explicitEquation = "x_n = \\frac{\\sqrt{5} - 1}{2\\sqrt{5}}" +
    "\\Bigg (\\frac{1 + \\sqrt{5}}{2}\\Bigg )^n" +
    " + \\frac{1 + \\sqrt{5}}{2\\sqrt{5}}" +
    "\\Bigg(\\frac{1 - \\sqrt{5}}{2}\\Bigg)^n"

katex.render(recursiveEquation, element, {displayMode: true});
katex.render(explicitEquation, element2, {displayMode: true});

var recursive = function(n) {
    if (n == 1 || n == 2) {
        return 1;
    } else {
        return recursive(n - 2) + recursive(n - 1);
    }
};

var recursive_list = function(n) {
    var list = []
    for (var i=1; i<=n; i++) {
        if (i == 1 || i == 2) {
            list.push(1);
        } else {
            first_callback = i - 2;
            second_callback = i - 3;
            list.push(list[first_callback] + list[second_callback]);
        }
    };
    return list;
};

var width = 960;
var height = 600;

var svg = d3.select('#svg')
            .attr('width', width)
            .attr('height', height);

var equationResult = d3.select(".equationResult")
var equationInput = d3.select(".equationInput")

var update = function(value) {
	d3.select(".equationInput").property("value", value);
    var result = recursive(parseInt(value));
    var equationResultKatex = document.getElementById("equationResult");
    var fibonacci_sequence = recursive_list(value);
    var rects = svg.selectAll("rect")
        .data(fibonacci_sequence)

    var last_x = 0;
    var last_y = 0;
    var scale = 10;

    var arcs = "";

    var startAngle = Math.PI;

    var drawArc = d3.arc()
        .innerRadius(function(d) { return  scale * d })
        .outerRadius(function(d) { return  scale * d - 1})
        .startAngle(function(d, i) { return startAngle })
        .endAngle(function(d, i) { 
            startAngle = startAngle - Math.PI/2;
            return startAngle 
        });

    var x = function(d, i) {
        if (i == 0) {
            var x = width/2
        } else if ((i % 4) == 1) {
            //above
            if (i == 1) {
                x = last_x;
            } else {
                var x = last_x - scale * fibonacci_sequence[i - 2];
            }
        } else if ((i % 4) == 2) {
            //left
            var x = last_x - scale * d;
        } else if ((i % 4) == 3) {
            //down
            var x = last_x;
        } else if ((i % 4) == 0) {
            //right
            var x = last_x + scale * fibonacci_sequence[i - 1];
        }
        last_x = x
        return x;
    }

    var y = function(d, i) {
         if (i == 0) {
            var y = height/2
        } else if ((i % 4) == 1) {
            //above
            if (i == 1) {
                y = last_y-scale * fibonacci_sequence[i - 1];
            } else {
                var y = last_y - scale * fibonacci_sequence[i - 1]-scale * fibonacci_sequence[i - 2];
            }
        } else if ((i % 4) == 2) {
            //left
            var y = last_y;
        } else if ((i % 4) == 3) {
            //down
            var y = last_y + scale * fibonacci_sequence[i - 1];
        } else if ((i % 4) == 0) {
            //right
            var y = last_y - scale * fibonacci_sequence[i - 2];
        }
        last_y = y
        return y;
    }

    rects.enter()
        .append("rect")
        .merge(rects)
        .attr("x", x)
        .transition()
        .duration(1000)
        .attr("y", y)
        .attr("stroke", "black")
        .attr("fill", "rgba(124,240,10,0.5)")
        .attr("width", function(d) {
            return d * scale;
        })
        .attr("height", function(d) {
            return d * scale;
        })

    var paths = svg.selectAll("path").data(fibonacci_sequence)

    paths.enter()
        .append("path")
        .merge(paths)
        .transition()
        .duration(1000)
        .attr("transform", function(d, i) {
            if (i % 4 == 0) {
                return "translate(" + x(d, i) + "," + y(d, i) + ")"
            } else if (i % 4 == 1) {
                return "translate(" + x(d, i) + "," + (y(d, i) + scale * d) + ")"
            } else if (i % 4 == 2) {
                return "translate(" + (x(d, i) + scale * d) + "," + (y(d, i) + scale * d) + ")"
            } else if (i % 4 == 3) {
                return "translate(" + (x(d, i) + scale * d)+ "," + y(d, i) + ")"
            }
        })
        .attr("d", drawArc);

    rects.exit().transition().duration(1000).attr("y", 0).remove();
    paths.exit().transition().duration(1000).remove();
    katex.render("f(" + value + ") = " + result, equationResultKatex);
    d3.select('.equationResult2').text(fibonacci_sequence);
};

update(9);

equationInput.on("input", function() {
	update(this.value);
});
}, false);
</script>
</body>
</html>
