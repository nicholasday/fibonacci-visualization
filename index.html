<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Fibonacci Visualization</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/katex.min.css" rel="stylesheet" >
    <link href="css/slider.css" rel="stylesheet" >
    <link href="css/styles.css" rel="stylesheet" >
</head>
<body>
<div class="container center">
    <h1 class="center">Fibonacci Sequence</h1>
    <hr />
    <div class="row">
        <div class="col-md-4">
            <h3 class="center">Recursive Equation</h3>
            <div id="equation"></div>
        </div>
        <div class="col-md-4 dynamic">
            <input type="range" min="1" max="15" id="equationInput" class="equationInput">
            <div id="equationResult" class="equationResult"></div>
            <div class="equationResult2"></div>
        </div>
        <div class="col-md-4">
            <h3 class="center">Explicit Equation</h3>
        </div>
    </div>
    <hr />
    <svg id="svg"></svg>
</div>
<script src="js/d3.min.js"></script>
<script src="js/katex.min.js"></script>
<script src="js/jquery-3.1.1.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script>
var element = document.getElementById("equation");

var recursiveEquation = "\\begin{aligned}" +
    "f(x)=\\begin{cases} " +
    "1 & x = 1, 2\\\\ " + 
    "f(x -2) + f(x - 1) & x > 1 " +
    "\\end{cases}" +
    "\\end{aligned}";

katex.render(recursiveEquation, element, {displayMode: true});

var recursive = function(n) {
    if (n == 1 || n == 2) {
        return 1;
    } else {
        return recursive(n - 2) + recursive(n - 1);
    }
};

var recursive_list = function(n) {
    var list = []
    for (var i=1; i<=n; i++) {
        if (i == 1 || i == 2) {
            list.push(1);
        } else {
            first_callback = i - 2;
            second_callback = i - 3;
            list.push(list[first_callback] + list[second_callback]);
        }
    };
    return list;
};

var width = 960;
var height = 600;

var svg = d3.select('#svg')
            .attr('width', width)
            .attr('height', height);

svg.style('border', '1px solid red');
var equationResult = d3.select(".equationResult")
var equationInput = d3.select(".equationInput")

var update = function(value) {
	d3.select(".equationInput").property("value", value);
    var result = recursive(parseInt(value));
    var equationResultKatex = document.getElementById("equationResult");
    var fibonacci_sequence = recursive_list(value);
    var rects = svg.selectAll("rect")
        .data(fibonacci_sequence)
        .enter()
        .append("rect")

    var last_x = 0;
    var last_y = 0;
    rects.attr("x", function(d, i) {
            if (i == 0) {
                var x = width/2
            } else if ((i % 4) == 1) {
                //above
                if (i == 1) {
                    x = last_x;
                } else {
                    var x = last_x - 20 * fibonacci_sequence[i - 2];
                }
            } else if ((i % 4) == 2) {
                //left
                var x = 20 * fibonacci_sequence[i - 1] + 20 * fibonacci_sequence[i - 2] + last_x;
            } else if ((i % 4) == 3) {
                //down
                var x = last_x;
            } else if ((i % 4) == 0) {
                //right
                var x = last_x + 20 * fibonacci_sequence[i - 1];
            }
            last_x = x
            return x;
        })
        .attr("y", function(d, i) {
            if (last_y == 0) {
                var y = height/2 - 20 * d
            } else {
                var y = last_y + 20 * (fibonacci_sequence[i-1])
            }
            last_y = y;
            return y;
        })
        .attr("fill", "rgba(124,240,10,0.5)")
        .attr("width", function(d) {
            return d * 20;
        })
        .attr("height", function(d) {
            return d * 20;
        });
    katex.render("f(" + value + ") = " + result, equationResultKatex);
    d3.select('.equationResult2').text(fibonacci_sequence);
};

update(9);

equationInput.on("input", function() {
	update(this.value);
});
</script>
</body>
</html>
